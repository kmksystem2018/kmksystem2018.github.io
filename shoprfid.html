<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>NFC címke olvasása NDEF Reader-rel</title>
    <script>
        // Funckió, hogy elindítsuk a NDEF olvasót
        async function startNFC() {
            if ("NFC" in window) {
                try {
                    // Indítjuk a NDEF címke olvasót
                    const nfc = new NDEFReader();
                    await nfc.scan(); // Ez elindítja az olvasást
                    
                    // Az olvasás eseménye: egy címke beolvasása
                    nfc.onreading = event => {
                        const nfcTag = event.message;
                        const nfcSerial = readNFCData(nfcTag);

                        // Az adatokat megjelenítjük
                        document.getElementById('nfcData').textContent = `Beolvasott NFC adat: ${nfcSerial}`;
                        
                        // További feldolgozás (pl. POST kérés a szériaszám elküldéséhez)
                        sendData(nfcSerial);
                    };
                } catch (error) {
                    alert(`Hiba történt az NFC olvasása során: ${error}`);
                }
            } else {
                alert("A Web NFC API nem támogatott ebben a böngészőben.");
            }
        }

        // A NDEF adatok kiolvasása és formázása
        function readNFCData(tag) {
            let serialNumber = '';
            for (const record of tag.records) {
                if (record.recordType === "text") {
                    serialNumber = record.data;
                }
            }
            return serialNumber;
        }

        // Az NFC adatokat elküldjük a PHP oldalnak
        function sendData(serialNumber) {
            const formData = new FormData();
            formData.append("nfcSerial", serialNumber);

            fetch('feldolgozo.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById('response').innerHTML = data;
            })
            .catch(error => console.error('Hiba:', error));
        }
    </script>
</head>
<body>
    <h1>NFC Címke Olvasása NDEF Reader-rel</h1>
    <button onclick="startNFC()">NFC címke beolvasása</button>
    <p id="nfcData">Itt jelenik meg a beolvasott NFC adat.</p>
    <div id="response"></div>
</body>
</html>
